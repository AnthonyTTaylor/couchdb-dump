{"_id":"_design/expired","_rev":"1-f29832c319e6e43ee73915ceecaac5c6","views":{"expired_hashes":{"map":"function(doc) { \r\n\thash_split = doc._id.split(':'); \r\n\tkey = hash_split[0]+ \"-\" + doc.username;\r\n\temit(key, [doc.timestamp, doc._id]);\r\n}","reduce":"function(keys, values) {\r\n\texpired_ids = [];\r\n\tif(values.length > 1) { \r\n\t\ttimeNow = new Date().getTime();\r\n\t\tvalues.sort();\r\n\t\tMILLISECONDS_PER_DAY = 86400000;\r\n\t\t// The expiration duration in days - BUG-3498���\r\n\t\tEXPIRY_DURATION = 60;\r\n\t\t// The latest hash will never be deleted\r\n\t\tfor(var index = 0; index < values.length - 1; index++) {\r\n\t\t\tdate = Number(values[index][0]);\r\n\t\t\t// should be in milliseconds\r\n\t\t\tvar timeDifference = timeNow - date;\r\n\t\t\tif(timeDifference > MILLISECONDS_PER_DAY * EXPIRY_DURATION) {\r\n\t\t\t\texpired_ids.push(values[index][1]);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(expired_ids.length > 0) {\r\n\t\treturn expired_ids; \r\n\t}\r\n}"}},"lists":{"nonulls":"function (head, req) { \r\n    var row, result_rows = []; \r\n    while (row = getRow()) {  \r\n        if (row.value != null) { \r\n            result_rows.push(row); \r\n        }  \r\n    }  \r\n    send('{\\\"rows\\\":' + JSON.stringify(result_rows) + '}'); \r\n}"},"shows":{},"language":"javascript","filters":{},"updates":{}}
